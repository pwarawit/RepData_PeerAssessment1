# Reproducible Research: Peer Assessment 1
This is the result of the peer assessment 1 assignment, part of Reproducible Research class.

## Loading and preprocessing the data
The below code chunk unzip the **activity.zip** file and then load data into **act_data** variable. After that, it transform the date variable to be date & time by combining date and interval.
```{r loading}
unzip("activity.zip")
act_data <- read.csv("activity.csv")
act_data$interval <- sprintf("%04d",as.numeric(act_data$interval))
act_data$date <- strptime(paste(act_data$date, act_data$interval, sep=" "), format="%Y-%m-%d %H%M")
```

## What is mean total number of steps taken per day?
For this part of the assignment, the missing value is ignored.

#### 1. Make a histogram of the total number of steps taken each day

```{r histogram}
hist(tapply(act_data$steps, as.Date(act_data$date), sum)
     ,main="Number of steps per day"
     ,xlab="Steps per day"
     ,ylab="Number of days"
     ,col="Grey"
     ,ylim=c(1,40)
     )
```

#### 2. Calculate and report the **mean** and **median** total number of steps taken per day
```{r mean_and_median}
act_mean <- mean(tapply(act_data$steps, as.Date(act_data$date), sum),na.rm=TRUE)
act_median <- median(tapply(act_data$steps, as.Date(act_data$date), sum),na.rm=TRUE)
```
Mean = **`r format(act_mean, digits=6, nsmall=3)`** steps per day
Median = **`r act_median`** steps per day

## What is the average daily activity pattern?
#### 1. Make a time series plot (i.e. `type = "l"`) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
```{r average_daily_pattern}
avg_step_interval <- as.data.frame(tapply(act_data$steps, act_data$interval, mean, na.rm=TRUE))
avg_step_interval <- cbind(as.data.frame(row.names(avg_step_interval)), avg_step_interval)
names(avg_step_interval) <- c("interval","avg_steps")
with(avg_step_interval, {plot(interval, avg_steps, type="l", xlab="Time of day", ylab="Avg steps", main="Daily Activity Pattern" )})

```
#### 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r max_step_interval}
max_step_interval <- avg_step_interval[avg_step_interval$avg_steps==max(avg_step_interval$avg_steps),"interval"]
```
The interval with maximum average number of steps is **`r max_step_interval`** interval. 

## Imputing missing values
There are number of days/intervals with missing values (coded as `NA`). This may introduce
bias into some calculations or summaries of the data.

#### 1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with `NA`s)
```{r count_na}
sum(is.na(act_data$step))
```
There are **`r sum(is.na(act_data$step))`** occurances of NA values.

#### 2. Devise a strategy for filling in all of the missing values in the dataset.
We will fill the missing value with the mean of that 5-minute interval across all days, since the data frame containing avarage steps for each interval has already been calculated. The object name is **avg_step_interval**.

#### 3. Create a new dataset that is equal to the original dataset but with the missing data filled in.
In order to create new dataset with the filled missing value, we need to join 2 data frame(act_data, and avg_step_interval) together with below code chunk.

```{r filling_na_values}
library(plyr)
temp1 <- join(act_data, avg_step_interval, by="interval")
temp2 <- temp1[!is.na(temp1$steps),c("steps","date","interval")]
temp3 <- temp1[is.na(temp1$steps),c("avg_steps","date","interval")]
names(temp3) <- c("steps", "date", "interval")
newdata <- arrange(rbind(temp2, temp3), date)
```

#### 4. Make a histogram of the total number of steps taken each day.
```{r histogram_compares}
par(mfrow = c(1,2))
hist(tapply(act_data$steps, as.Date(act_data$date), sum)
     ,main="Steps/day - NA ignored"
     ,xlab="" #"Steps per day"
     ,ylab="Number of days"
     ,col="Red"
     ,ylim=c(1,40)
     )
hist(tapply(newdata$steps, as.Date(newdata$date), sum)
     ,main="Steps/day - NA filled"
     ,xlab="" #"Steps per day"
     ,ylab="" #"Number of days"
     ,col="Blue"
     ,ylim=c(1,40)
     )
```

The histogram is intentionally put side-by-side with the histogram of the original dataset. 
**Conclusion** Though the magnitude of the frequency of daily steps are different between the original dataset and the imputted dataset, the overall data distribution does not change much. 

#### Calculate and report the **mean** and **median** total number of steps taken per day with the new data set.
```{r mean_and_median_na_filled}
act_mean_na_filled <- mean(tapply(newdata$steps, as.Date(act_data$date), sum))
act_median_na_filled <- median(tapply(newdata$steps, as.Date(act_data$date), sum))
```
Mean = **`r format(act_mean_na_filled, digits=6, nsmall=3)`** steps per day
Median = **`r format(act_median_na_filled, digits=6, nsmall=3)`** steps per day

This again, confirms the conclusion that the mean and median of 2 dataset do not have significant differences.

#### Do these values differ from the estimates from the first part of the assignment? 
NO, there is no different. 

#### What is the impact of imputing missing data on the estimates of the total daily number of steps?
The total number of steps are increasing, but the data characteristics does not change.

## Are there differences in activity patterns between weekdays and weekends?
Use the dataset with the filled-in missing values for this part.

#### 1. Create a new factor variable in the dataset with two levels -- "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.

```{r create_weekday_factor}
newdata$factor <- ifelse(weekdays(as.Date(newdata$date)) %in% c("Saturday","Sunday"),"weekends","weekdays")
```

#### 2. Make a panel plot containing a time series plot (i.e. `type = "l"`) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). The plot should look something like the following, which was creating using **simulated data**:


```{r wkdays_wkends_compare}
# Prepare weekdays data
wkdays_full <- newdata[weekdays(as.Date(newdata$date))!=c("Satureday","Sunday"),]
wkdays <- as.data.frame(tapply(wkdays_full$steps, wkdays_full$interval, mean))
wkdays <- cbind(as.data.frame(row.names(wkdays)), wkdays)
names(wkdays) <- c("interval","avg_steps")

# Preare weekends data
wkends_full <- newdata[weekdays(as.Date(newdata$date))==c("Satureday","Sunday"),]
wkends <- as.data.frame(tapply(wkends_full$steps, wkends_full$interval, mean))
wkends <- cbind(as.data.frame(row.names(wkends)), wkends)
names(wkends) <- c("interval","avg_steps")

# Plot comparison
#par(mfrow = c(2,1))
with(wkdays, {plot(interval, avg_steps, type="l", xlab="Time of day", ylab="Avg steps", main="Weekdays Activity Pattern" )})
with(wkends, {plot(interval, avg_steps, type="l", xlab="Time of day", ylab="Avg steps", main="Weekends Activity Pattern" )})

```

**Conclusion** Yes, there are differences between weekdays and weekends activity patterns. There are more during the day activities on weekends compare to weekdays. 

```{r weekdays_factor}


```



```{r wkdays_wkends_compare}

wkdays_full <- newdata[weekdays(as.Date(newdata$date))!=c("Sunday","Monday"),]
wkdays <- as.data.frame(tapply(wkdays_full$steps, wkdays_full$interval, mean))
wkdays <- cbind(as.data.frame(row.names(wkdays)), wkdays)
names(wkdays) <- c("interval","avg_steps")
with(wkdays, {plot(interval, avg_steps, type="l", xlab="Time of day", ylab="Avg steps", main="Daily Activity Pattern" )})

wkends_full <- newdata[weekdays(as.Date(newdata$date))==c("Sunday","Monday"),]
wkends <- as.data.frame(tapply(wkends_full$steps, wkends_full$interval, mean))
wkends <- cbind(as.data.frame(row.names(wkends)), wkends)
names(wkends) <- c("interval","avg_steps")
with(wkends, {plot(interval, avg_steps, type="l", xlab="Time of day", ylab="Avg steps", main="Daily Activity Pattern" )})



```

newdata$factor 

newdata$factor <- ifelse(weekdays(as.Date(newdata$date)) %in% c("Saturday","Sunday"),"weekends","weekdays")
mydata <- as.data.frame(tapply(newdata$steps, list(newdata$interval, newdata$factor), mean))
mydata <- cbind(as.data.frame(row.names(mydata)), mydata)
names(mydata) <- c("interval","weekday_steps","weekend_steps")